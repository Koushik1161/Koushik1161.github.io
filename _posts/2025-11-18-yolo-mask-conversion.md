---
layout: post
title: "From SAM2 to YOLO: Bridging Segmentation and Detection"
subtitle: "Building a pipeline to convert mask annotations into YOLO format"
date: 2025-11-18
---

Object detection and instance segmentation solve related but different problems. Detection draws boxes; segmentation draws precise outlines. But what if you want to train YOLO using masks generated by SAM2?

That requires a conversion pipeline.

## The Problem: Format Mismatch

SAM2 (Segment Anything Model 2) produces pixel-perfect masks:

```
[
    [0, 0, 0, 0, 0],
    [0, 1, 1, 1, 0],
    [0, 1, 1, 1, 0],
    [0, 0, 0, 0, 0]
]
```

YOLO expects normalized bounding boxes:

```
0 0.5 0.5 0.6 0.4  # class_id, center_x, center_y, width, height
```

The conversion extracts the bounding box from the mask and normalizes coordinates.

## The Conversion Logic

```python
import numpy as np

def mask_to_yolo(mask: np.ndarray, class_id: int, img_width: int, img_height: int) -> str:
    # Find mask boundaries
    rows = np.any(mask, axis=1)
    cols = np.any(mask, axis=0)

    y_min, y_max = np.where(rows)[0][[0, -1]]
    x_min, x_max = np.where(cols)[0][[0, -1]]

    # Calculate center and dimensions
    center_x = (x_min + x_max) / 2 / img_width
    center_y = (y_min + y_max) / 2 / img_height
    width = (x_max - x_min) / img_width
    height = (y_max - y_min) / img_height

    return f"{class_id} {center_x:.6f} {center_y:.6f} {width:.6f} {height:.6f}"
```

Find the bounding rectangle of the mask, then normalize to 0-1 range. Simple geometry.

## Why SAM2 + YOLO?

Each model has strengths:

**SAM2** excels at precise segmentation. Point at something, get its exact outline. Perfect for generating training data from unlabeled images.

**YOLO** excels at fast detection. Real-time performance, well-optimized, widely deployed. Perfect for production inference.

The pipeline: use SAM2 to generate high-quality annotations, convert to YOLO format, train a YOLO detector. You get SAM2's annotation quality with YOLO's inference speed.

## The Use Case: Fruit Detection

My test case was detecting oranges on a conveyor belt—a classic industrial vision application:

```python
from ultralytics import YOLO
from sam2 import SAM2

# Generate masks with SAM2
sam = SAM2.from_pretrained("sam2_t")
masks = sam.predict("oranges.png", points=[(100, 150), (300, 200)])

# Convert to YOLO format
yolo_labels = []
for i, mask in enumerate(masks):
    label = mask_to_yolo(mask, class_id=0, img_width=640, img_height=480)
    yolo_labels.append(label)

# Write labels file
with open("oranges.txt", "w") as f:
    f.write("\n".join(yolo_labels))
```

Point-and-click annotation with SAM2, automatic conversion to YOLO training format.

## SAM2 Tiny: Efficiency Matters

I used `sam2_t.pt`, the tiny variant at 78MB. Why?

- Full SAM2: 2.4GB, ~500ms per image
- SAM2 Tiny: 78MB, ~100ms per image

For annotation workflows where you process many images, 5x speedup matters. The quality difference is acceptable for bounding box extraction—you don't need perfect edges when you're just finding corners.

## Where This Leads

The immediate application is training data generation. Instead of manually drawing boxes around objects, you:

1. Run SAM2 in interactive mode
2. Click to indicate objects of interest
3. Export masks
4. Convert to YOLO format
5. Train YOLO detector

For large datasets, this could cut annotation time dramatically.

Longer term, the pipeline enables hybrid systems: use SAM2 when you need precision, YOLO when you need speed, share training data between them.

## Current Status: Work in Progress

The conversion script exists. The SAM2 model is downloaded. The test images are ready. What's left:

- End-to-end pipeline automation
- Batch processing for multiple images
- YOLO training integration
- Evaluation on held-out test set

It's a proof of concept, not a finished product. But the pieces connect.

## Lessons Learned

**Model size matters in practice.** The theoretical best model is useless if it's too slow for your workflow. SAM2 Tiny is "good enough" for annotation.

**Format conversion is unglamorous but essential.** The interesting work is in SAM2 and YOLO. The conversion script is just glue. But without glue, nothing sticks together.

**Start with the end in mind.** Knowing I wanted YOLO detection shaped the entire pipeline design. The mask was never the goal—it was a means to better bounding boxes.

---

*Built with Ultralytics YOLO, Meta SAM2, and the belief that the best tool for a job often involves combining multiple specialized tools.*
