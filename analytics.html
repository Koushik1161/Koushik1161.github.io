---
layout: default
title: Analytics
---

<div class="analytics-dashboard">
  <header class="analytics-header">
    <div class="analytics-header__left">
      <h1 class="analytics-title">Analytics</h1>
      <p class="analytics-subtitle">Real-time insights for koushik1161.github.io</p>
    </div>
    <div class="analytics-header__right">
      <select id="date-range" class="date-selector">
        <option value="7">Last 7 days</option>
        <option value="30">Last 30 days</option>
        <option value="90">Last 90 days</option>
      </select>
      <button id="refresh-btn" class="refresh-btn" aria-label="Refresh">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Loading State -->
  <div id="loading-state" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading analytics...</p>
  </div>

  <!-- Error State -->
  <div id="error-state" class="error-state" style="display: none;">
    <p>Unable to load analytics. <button onclick="loadAnalytics()">Try again</button></p>
  </div>

  <!-- Dashboard Content -->
  <div id="dashboard-content" class="dashboard-content" style="display: none;">

    <!-- Key Metrics -->
    <section class="metrics-grid">
      <div class="metric-card">
        <span class="metric-label">Total Views</span>
        <span class="metric-value" id="total-views">-</span>
      </div>
      <div class="metric-card">
        <span class="metric-label">Top Page</span>
        <span class="metric-value metric-value--small" id="top-page">-</span>
      </div>
      <div class="metric-card">
        <span class="metric-label">Top Country</span>
        <span class="metric-value" id="top-country">-</span>
      </div>
      <div class="metric-card">
        <span class="metric-label">Top Referrer</span>
        <span class="metric-value metric-value--small" id="top-referrer">-</span>
      </div>
    </section>

    <!-- Chart Section -->
    <section class="chart-section">
      <h2 class="section-title">Daily Views</h2>
      <div class="chart-container">
        <canvas id="views-chart"></canvas>
      </div>
    </section>

    <!-- Two Column Layout -->
    <div class="two-column">

      <!-- Top Pages -->
      <section class="data-section">
        <h2 class="section-title">Top Pages</h2>
        <div class="data-list" id="top-pages-list">
          <div class="data-item skeleton"></div>
          <div class="data-item skeleton"></div>
          <div class="data-item skeleton"></div>
        </div>
      </section>

      <!-- Countries -->
      <section class="data-section">
        <h2 class="section-title">Countries</h2>
        <div class="data-list" id="countries-list">
          <div class="data-item skeleton"></div>
          <div class="data-item skeleton"></div>
          <div class="data-item skeleton"></div>
        </div>
      </section>

    </div>

    <!-- Referrers -->
    <section class="data-section">
      <h2 class="section-title">Referrers</h2>
      <div class="data-list" id="referrers-list">
        <div class="data-item skeleton"></div>
        <div class="data-item skeleton"></div>
      </div>
    </section>

  </div>
</div>

<style>
/* Analytics Dashboard Styles */
.analytics-dashboard {
  max-width: 100%;
}

.analytics-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: var(--space-4);
  margin-bottom: var(--space-6);
  flex-wrap: wrap;
}

.analytics-title {
  font-size: var(--text-2xl);
  font-weight: 500;
  margin-bottom: var(--space-1);
}

.analytics-subtitle {
  font-size: var(--text-sm);
  color: var(--color-text-tertiary);
}

.analytics-header__right {
  display: flex;
  gap: var(--space-2);
  align-items: center;
}

.date-selector {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  color: var(--color-text);
  padding: var(--space-1) var(--space-2);
  border-radius: 6px;
  font-size: var(--text-sm);
  cursor: pointer;
  transition: border-color var(--duration-fast) var(--ease-out);
}

.date-selector:hover {
  border-color: var(--color-text-tertiary);
}

.refresh-btn {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  color: var(--color-text-secondary);
  padding: var(--space-1);
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--duration-fast) var(--ease-out);
}

.refresh-btn:hover {
  border-color: var(--color-text-tertiary);
  color: var(--color-text);
}

.refresh-btn.loading svg {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Loading State */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-12) 0;
  color: var(--color-text-tertiary);
}

.loading-spinner {
  width: 32px;
  height: 32px;
  border: 2px solid var(--color-border);
  border-top-color: var(--color-text);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-bottom: var(--space-2);
}

.error-state {
  text-align: center;
  padding: var(--space-8) 0;
  color: var(--color-text-secondary);
}

.error-state button {
  background: none;
  border: none;
  color: var(--color-text);
  text-decoration: underline;
  cursor: pointer;
}

/* Metrics Grid */
.metrics-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-3);
  margin-bottom: var(--space-6);
}

@media (min-width: 640px) {
  .metrics-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

.metric-card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: var(--space-3);
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
  transition: all var(--duration-slow) var(--ease-out);
}

.metric-label {
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
  text-transform: uppercase;
  letter-spacing: var(--tracking-wide);
}

.metric-value {
  font-size: var(--text-xl);
  font-weight: 600;
  color: var(--color-text);
}

.metric-value--small {
  font-size: var(--text-sm);
  font-weight: 500;
  word-break: break-all;
}

/* Chart Section */
.chart-section {
  margin-bottom: var(--space-6);
}

.section-title {
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: var(--tracking-wide);
  margin-bottom: var(--space-3);
}

.chart-container {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: var(--space-4);
  height: 200px;
  transition: all var(--duration-slow) var(--ease-out);
}

/* Two Column Layout */
.two-column {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-4);
  margin-bottom: var(--space-6);
}

@media (min-width: 640px) {
  .two-column {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Data Sections */
.data-section {
  margin-bottom: var(--space-4);
}

.data-list {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  overflow: hidden;
  transition: all var(--duration-slow) var(--ease-out);
}

.data-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-2) var(--space-3);
  border-bottom: 1px solid var(--color-border);
  font-size: var(--text-sm);
}

.data-item:last-child {
  border-bottom: none;
}

.data-item__label {
  color: var(--color-text);
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-right: var(--space-2);
}

.data-item__value {
  color: var(--color-text-tertiary);
  font-weight: 500;
  flex-shrink: 0;
}

.data-item__bar {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  background: var(--color-surface-elevated);
  z-index: -1;
  transition: width var(--duration-normal) var(--ease-out);
}

.data-item {
  position: relative;
}

/* Skeleton Loading */
.skeleton {
  background: linear-gradient(90deg, var(--color-surface) 25%, var(--color-surface-elevated) 50%, var(--color-surface) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  height: 40px;
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

/* Empty State */
.empty-state {
  padding: var(--space-4);
  text-align: center;
  color: var(--color-text-tertiary);
  font-size: var(--text-sm);
}
</style>

<script>
const API_ENDPOINT = 'https://analytics-api.koushikcruz.workers.dev/stats';

async function loadAnalytics() {
  const days = document.getElementById('date-range').value;
  const loadingState = document.getElementById('loading-state');
  const errorState = document.getElementById('error-state');
  const dashboardContent = document.getElementById('dashboard-content');
  const refreshBtn = document.getElementById('refresh-btn');

  // Show loading
  loadingState.style.display = 'flex';
  errorState.style.display = 'none';
  dashboardContent.style.display = 'none';
  refreshBtn.classList.add('loading');

  try {
    const response = await fetch(`${API_ENDPOINT}?days=${days}`);
    const data = await response.json();

    if (data.error) throw new Error(data.error);

    // Update metrics
    document.getElementById('total-views').textContent = formatNumber(data.totalViews);
    document.getElementById('top-page').textContent = data.topPages?.[0]?.path || 'No data';
    document.getElementById('top-country').textContent = data.countries?.[0]?.country || 'No data';
    document.getElementById('top-referrer').textContent = data.topReferrers?.[0]?.referrer || 'Direct';

    // Render lists
    renderList('top-pages-list', data.topPages, 'path', 'views');
    renderList('countries-list', data.countries, 'country', 'count');
    renderList('referrers-list', data.topReferrers, 'referrer', 'count');

    // Render chart
    renderChart(data.daily);

    // Show dashboard
    loadingState.style.display = 'none';
    dashboardContent.style.display = 'block';

  } catch (error) {
    console.error('Analytics error:', error);
    loadingState.style.display = 'none';
    errorState.style.display = 'block';
  } finally {
    refreshBtn.classList.remove('loading');
  }
}

function formatNumber(num) {
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
  return num?.toString() || '0';
}

function renderList(elementId, items, labelKey, valueKey) {
  const container = document.getElementById(elementId);

  if (!items || items.length === 0) {
    container.innerHTML = '<div class="empty-state">No data yet</div>';
    return;
  }

  const maxValue = Math.max(...items.map(item => item[valueKey]));

  container.innerHTML = items.map(item => {
    const percentage = (item[valueKey] / maxValue) * 100;
    const label = item[labelKey] || 'Unknown';
    const displayLabel = labelKey === 'path' ? (label === '/' ? 'Home' : label.replace(/^\//, '').replace(/-/g, ' ')) : label;

    return `
      <div class="data-item">
        <div class="data-item__bar" style="width: ${percentage}%"></div>
        <span class="data-item__label" title="${label}">${displayLabel}</span>
        <span class="data-item__value">${formatNumber(item[valueKey])}</span>
      </div>
    `;
  }).join('');
}

function renderChart(dailyData) {
  const canvas = document.getElementById('views-chart');
  const ctx = canvas.getContext('2d');

  // Set canvas size
  const container = canvas.parentElement;
  canvas.width = container.clientWidth;
  canvas.height = container.clientHeight;

  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!dailyData || dailyData.length === 0) {
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-text-tertiary').trim();
    ctx.font = '14px Inter, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('No data yet', canvas.width / 2, canvas.height / 2);
    return;
  }

  const padding = { top: 20, right: 20, bottom: 40, left: 50 };
  const chartWidth = canvas.width - padding.left - padding.right;
  const chartHeight = canvas.height - padding.top - padding.bottom;

  const values = dailyData.map(d => d.views);
  const maxValue = Math.max(...values, 1);
  const minValue = 0;

  // Get colors from CSS
  const textColor = getComputedStyle(document.documentElement).getPropertyValue('--color-text-tertiary').trim();
  const lineColor = getComputedStyle(document.documentElement).getPropertyValue('--color-text').trim();
  const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--color-border').trim();

  // Draw grid lines
  ctx.strokeStyle = gridColor;
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = padding.top + (chartHeight * i) / 4;
    ctx.beginPath();
    ctx.moveTo(padding.left, y);
    ctx.lineTo(canvas.width - padding.right, y);
    ctx.stroke();
  }

  // Draw Y-axis labels
  ctx.fillStyle = textColor;
  ctx.font = '11px Inter, sans-serif';
  ctx.textAlign = 'right';
  for (let i = 0; i <= 4; i++) {
    const value = maxValue - (maxValue * i) / 4;
    const y = padding.top + (chartHeight * i) / 4;
    ctx.fillText(formatNumber(Math.round(value)), padding.left - 10, y + 4);
  }

  // Draw line chart
  ctx.strokeStyle = lineColor;
  ctx.lineWidth = 2;
  ctx.lineJoin = 'round';
  ctx.lineCap = 'round';
  ctx.beginPath();

  dailyData.forEach((point, index) => {
    const x = padding.left + (index / (dailyData.length - 1 || 1)) * chartWidth;
    const y = padding.top + chartHeight - ((point.views - minValue) / (maxValue - minValue || 1)) * chartHeight;

    if (index === 0) {
      ctx.moveTo(x, y);
    } else {
      ctx.lineTo(x, y);
    }
  });
  ctx.stroke();

  // Draw dots
  dailyData.forEach((point, index) => {
    const x = padding.left + (index / (dailyData.length - 1 || 1)) * chartWidth;
    const y = padding.top + chartHeight - ((point.views - minValue) / (maxValue - minValue || 1)) * chartHeight;

    ctx.beginPath();
    ctx.arc(x, y, 4, 0, Math.PI * 2);
    ctx.fillStyle = lineColor;
    ctx.fill();
  });

  // Draw X-axis labels (dates)
  ctx.fillStyle = textColor;
  ctx.font = '10px Inter, sans-serif';
  ctx.textAlign = 'center';

  const labelInterval = Math.ceil(dailyData.length / 7);
  dailyData.forEach((point, index) => {
    if (index % labelInterval === 0 || index === dailyData.length - 1) {
      const x = padding.left + (index / (dailyData.length - 1 || 1)) * chartWidth;
      const date = new Date(point.date);
      const label = `${date.getMonth() + 1}/${date.getDate()}`;
      ctx.fillText(label, x, canvas.height - 10);
    }
  });
}

// Event listeners
document.getElementById('date-range').addEventListener('change', loadAnalytics);
document.getElementById('refresh-btn').addEventListener('click', loadAnalytics);

// Handle window resize for chart
let resizeTimeout;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => {
    const dashboardContent = document.getElementById('dashboard-content');
    if (dashboardContent.style.display !== 'none') {
      loadAnalytics();
    }
  }, 250);
});

// Initial load
loadAnalytics();
</script>
